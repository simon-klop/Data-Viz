<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->

<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-array.v2.min.js"></script>


<!-- Create a div where the graph will take place -->
<div id="number_clients"></div>

<div id="my_dataviz2"></div>

<div id="my_dataviz3"></div>


<script>

function TestHist() {
// set the dimensions and margins of the graph
    var margin = {top: 10, right: 30, bottom: 30, left: 40}
    const width = 700
    const height = 400

    // append the svg object to the body of the page
    var svg = d3.select("#my_dataviz2")
    .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
    .append("g")
        .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

    // get the data
    d3.csv("https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/1_OneNum.csv", function(data) {

    // X axis: scale and draw:
    var x = d3.scaleLinear()
        .domain([0, 1000])     // can use this instead of 1000 to have the max of data: d3.max(data, function(d) { return +d.price })
        .range([0, width]);
    svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));

    // set the parameters for the histogram
    var histogram = d3.histogram()
        .value(function(d) { return d.price; })   // I need to give the vector of value
        .domain(x.domain())  // then the domain of the graphic
        .thresholds(x.ticks(70)); // then the numbers of bins

    // And apply this function to data to get the bins
    var bins = histogram(data);

    // Y axis: scale and draw:
    var y = d3.scaleLinear()
        .range([height, 0]);
        y.domain([0, d3.max(bins, function(d) { return d.length; })]);   // d3.hist has to be called before the Y axis obviously
    svg.append("g")
        .call(d3.axisLeft(y));

    // append the bar rectangles to the svg element
    svg.selectAll("rect")
        .data(bins)
        .enter()
        .append("rect")
            .attr("x", 1)
            .attr("transform", function(d) { return "translate(" + x(d.x0) + "," + y(d.length) + ")"; })
            .attr("width", function(d) { return x(d.x1) - x(d.x0) -1 ; })
            .attr("height", function(d) { return height - y(d.length); })
            .style("fill", "#69b3a2")

    });

}

function BakeryViz1(dataset) {
    
    //console.log(dataset)
    console.log("hey")

    const margin = ({top: 20, right: 100, bottom: 35, left: 50})
  
    const w = 1200
    const h = 400

    const svg = d3.select("#number_clients").append("svg").attr("height", h).attr("width", w)


    const binX = d3.bin()
    const buckets1 = binX(dataset.map((d) => d.date))

 
    
    const x = d3.scaleTime()
        .domain([d3.min(buckets1.map(d => d.x0)),  d3.max(buckets1.map(d => d.x1))])
        .range([margin.left, w - margin.left - margin.right])
    svg.append("g")
             .attr("transform", `translate(0,${h - margin.bottom})`)
             .call(d3.axisBottom(x));

    // const bin = d3.bin().domain(x.domain()).thresholds(x.ticks(20));
    // const buckets_time = bin(dataset.map((d) => d.date));


    const my_map = d3.groups(dataset, d => d.ticket_number)

    const y = d3.scaleLinear()
        .domain([0, d3.count(my_map, d => d[0])])
        .range([h-margin.bottom, margin.top])
    svg.append("g")
            .attr("transform", `translate(${margin.left},0)`)
             .call(d3.axisLeft(y));




     svg.selectAll("rect_clients")
         .data(my_map)
         .enter()
    //     .append("rect") 
    //     .transition()
    //     .duration(1000)
    //     .attr("transform", d => "translate(" + x(d.x0) + "," + y(d.length) + ")" )
    //       .attr("width", d => x(d.x1) - x(d.x0) -1 )
    //       .attr("height", d => h - y(d.length) - margin.bottom)
    //       .style("fill",  "red")
    //      .style("opacity", 0.6)

    // axis label

        // Title
       svg.append('text')
        .attr('x',w/2 -30)
        .attr('y', 20)
        .attr('text-anchor', 'middle')
        .style('font-family', 'Helvetica')
        .style('font-size', 20)
        .text('Number of clients by time');
  
      // X label
        svg.append('text')
        .attr('x', w/2 - 30)
        .attr('y', h - margin.bottom +30)
        .attr('text-anchor', 'middle')
        .style('font-family', 'Helvetica')
        .style('font-size', 12)
        .text('Time');
        
        // Y label
        svg.append('text')
        .attr('text-anchor', 'middle')
        .attr('transform', 'translate(20,' + h/2 + ')rotate(-90)')
        .style('font-family', 'Helvetica')
        .style('font-size', 12)
        .text("Number");
}


function BakeryViz2(data) {
    //console.log(data)
    console.log("hey")
}


function hist(dataset) {
  
  const l = [...new Set(dataset.map(d => d.species))];
  const c = d3.scaleOrdinal().domain(new Set(dataset.map(d => d.species))).range(["red", "green", "blue"])
  
  const w = 700
  const h = 400
  const margin = ({top: 30, right: 100, bottom: 40, left: 40})
  const svg = d3.select("#my_dataviz").append("svg").attr("height", h).attr("width", w)

  const binX = d3.bin()
  const buckets1 = binX(dataset.map((d) => d.sepal_length))
  
  const x = d3.scaleLinear()
    .domain([d3.min(buckets1.map(d => d.x0)),  d3.max(buckets1.map(d => d.x1))])
    .range([margin.left, w - margin.left - margin.right])
  
  svg.append("g")
         .attr("transform", `translate(0,${h - margin.bottom})`)
         .call(d3.axisBottom(x));

  
  const bin = d3.bin().domain(x.domain()).thresholds(x.ticks(20));  
  const buckets_sepal = bin(dataset.filter( s => s.species == "setosa").map(d => d.sepal_length));
  const buckets_versicolor = bin(dataset.filter( s => s.species == "versicolor").map(d => d.sepal_length));
  const buckets_virginica = bin(dataset.filter( s => s.species == "virginica").map(d => d.sepal_length));

  const length_Y_axis = d3.max([
    d3.max(buckets_sepal, (d) => d.length),
    d3.max(buckets_versicolor, (d) => d.length),
    d3.max(buckets_virginica, (d) => d.length)])


  
  const y = d3.scaleLinear()
     .domain([0, length_Y_axis])
     .range([h-margin.bottom, margin.top])
  svg.append("g")
         .attr("transform", `translate(${margin.left},0)`)
         .call(d3.axisLeft(y));

    
    svg.selectAll("rect_sepal")
        .data(buckets_sepal)
        .enter()
        .append("rect") 
        .transition()
        .duration(1000)
        .attr("transform", d => "translate(" + x(d.x0) + "," + y(d.length) + ")" )
          .attr("width", d => x(d.x1) - x(d.x0))
          .attr("height", d => h - y(d.length) - margin.bottom)
          .style("fill",  "red")
         .style("opacity", 0.6)

  
//      svg.selectAll("rect_versicolor")
//         .data(buckets_versicolor)
//         .enter()
//         .append("rect") 
//         .transition()
//         .duration(1000)
//         .attr("transform", d => "translate(" + x(d.x0) + "," + y(d.length) + ")" )
//           .attr("width", d => x(d.x1) - x(d.x0) -1 )
//           .attr("height", d => h - y(d.length) - margin.bottom)
//           .style("fill",  "green")
//          .style("opacity", 0.6)

//    svg.selectAll("rect_virginica")
//         .data(buckets_virginica)
//         .enter()
//         .append("rect") 
//         .transition()
//         .duration(1000)
//         .attr("transform", d => "translate(" + x(d.x0) + "," + y(d.length) + ")" )
//           .attr("width", d => x(d.x1) - x(d.x0) -1 )
//           .attr("height", d => h - y(d.length) - margin.bottom)
//           .style("fill",  "blue")
//         .style("opacity", 0.6)


//   //LEGEND

//     svg.selectAll("rectangle").data(c.domain()).enter()
//       .append("rect")
//       .attr("x", d => w - margin.right)
//       .attr("y", (d, i) => i * 20)
//       .attr("width", d => 10)
//       .attr("height", d => 10)      
//       .style("fill", d => c(d))
  
//      svg.append("g").selectAll("text").data(l).enter()
//       .append("text")
//       .attr("x", d => w - margin.right + 10)
//       .attr("y", (d, i) => i * 20+10)   
//       .text(d => d)



  // axis label

        // Title
       svg.append('text')
        .attr('x', w/2 -30)
        .attr('y', 20)
        .attr('text-anchor', 'middle')
        .style('font-family', 'Helvetica')
        .style('font-size', 20)
        .text('Number of flowers by Sepal Lenght interval');
  
        // X label
        svg.append('text')
        .attr('x', w/2 - 30)
        .attr('y', h - margin.bottom +30)
        .attr('text-anchor', 'middle')
        .style('font-family', 'Helvetica')
        .style('font-size', 12)
        .text('Sepal Length');
        
        // Y label
        svg.append('text')
        .attr('text-anchor', 'middle')
        .attr('transform', 'translate(20,' + h/2 + ')rotate(-90)')
        .style('font-family', 'Helvetica')
        .style('font-size', 12)
        .text("Number");

}


function Training() {
    d3.csv(
        //"https://raw.githubusercontent.com/LyonDataViz/MOS5.5-Dataviz/master/data/stocks.csv", 
        "https://gist.githubusercontent.com/curran/a08a1080b88344b0c8a7/raw/0e7a9b0a5d22642a06d3d5b9bcbad9890c8ee534/iris.csv",
        //"https://simon-klop.github.io/Data-Viz/Bakery_clean.csv",
        //"https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/1_OneNum.csv",
        function(data) {
            BakeryViz1(data)
            BakeryViz2(data)
            hist(data)
        })
}

function conversor(d){
    const parseTime = d3.timeParse("%Y-%m-%d");
    d.date = parseTime(d.date)
    d.unit_price = +d.unit_price
    d.ticket_number = +d.ticket_number
    d.quantity = +d.quantity
    return d;
}

async function LoadBakeryAndDraw() {
    d3.csv(
        "https://simon-klop.github.io/Data-Viz/Bakery_clean.csv",
        conversor,
        function(data) {
            //console.log(d)
            BakeryViz1(data)


        })
}


TestHist()
LoadBakeryAndDraw()



</script>